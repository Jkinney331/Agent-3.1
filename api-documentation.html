<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Crypto Trading Bot - API Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 0;
            text-align: center;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.25rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .nav {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .nav ul {
            list-style: none;
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .nav a {
            color: #475569;
            text-decoration: none;
            font-weight: 500;
            padding: 10px 15px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .nav a:hover {
            background: #f1f5f9;
            color: #667eea;
        }
        
        .main {
            padding: 40px 0;
        }
        
        .section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            margin-bottom: 40px;
            overflow: hidden;
        }
        
        .section-header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 30px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .section-header h2 {
            font-size: 2rem;
            color: #1e293b;
            margin-bottom: 10px;
        }
        
        .section-header p {
            color: #64748b;
            font-size: 1.1rem;
        }
        
        .section-content {
            padding: 30px;
        }
        
        .endpoint {
            margin-bottom: 40px;
            padding: 25px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #fafbfc;
        }
        
        .endpoint:last-child {
            margin-bottom: 0;
        }
        
        .endpoint-title {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .method {
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .method.post {
            background: #dc2626;
            color: white;
        }
        
        .method.get {
            background: #059669;
            color: white;
        }
        
        .method.put {
            background: #d97706;
            color: white;
        }
        
        .method.delete {
            background: #dc2626;
            color: white;
        }
        
        .url {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 1.1rem;
            color: #1e293b;
            font-weight: 600;
        }
        
        .description {
            color: #64748b;
            margin-bottom: 25px;
            font-size: 1rem;
        }
        
        .auth-required {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: #fef3c7;
            color: #92400e;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .tabs {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .tab-headers {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .tab-header {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s ease;
            flex: 1;
            text-align: center;
        }
        
        .tab-header.active {
            background: white;
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }
        
        .tab-content {
            padding: 20px;
            background: white;
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            overflow-x: auto;
            margin: 15px 0;
            position: relative;
        }
        
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #334155;
        }
        
        .code-lang {
            font-size: 0.75rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .copy-btn {
            background: #475569;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s ease;
        }
        
        .copy-btn:hover {
            background: #64748b;
        }
        
        .parameter-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .parameter-table th,
        .parameter-table td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .parameter-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
        }
        
        .parameter-table .required {
            color: #dc2626;
            font-weight: 600;
        }
        
        .parameter-table .optional {
            color: #059669;
            font-weight: 600;
        }
        
        .parameter-table code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
        }
        
        .response-example {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .response-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #374151;
        }
        
        .status-code {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.875rem;
            margin-left: 10px;
        }
        
        .status-200 { background: #dcfce7; color: #166534; }
        .status-400 { background: #fee2e2; color: #dc2626; }
        .status-401 { background: #fef3c7; color: #92400e; }
        .status-500 { background: #fee2e2; color: #dc2626; }
        
        .auth-section {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .auth-section h4 {
            color: #92400e;
            margin-bottom: 10px;
        }
        
        .auth-section p {
            color: #92400e;
            margin-bottom: 10px;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            margin: 15px 0;
        }
        
        .test-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .feature-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 25px;
            transition: all 0.2s ease;
        }
        
        .feature-card:hover {
            border-color: #667eea;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }
        
        .feature-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }
        
        .feature-card h3 {
            color: #1e293b;
            margin-bottom: 10px;
        }
        
        .feature-card p {
            color: #64748b;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>AI Crypto Trading Bot API</h1>
            <p>Complete API documentation for n8n workflow integration, real-time trading execution, and portfolio management</p>
        </div>
    </div>
    
    <nav class="nav">
        <div class="container">
            <ul>
                <li><a href="#overview">Overview</a></li>
                <li><a href="#authentication">Authentication</a></li>
                <li><a href="#n8n-integration">N8N Integration</a></li>
                <li><a href="#n8n-webhook">N8N Webhook</a></li>
                <li><a href="#trading-execution">Trading Execution</a></li>
                <li><a href="#examples">Code Examples</a></li>
                <li><a href="#integration-guide">Integration Guide</a></li>
                <li><a href="#troubleshooting">Troubleshooting</a></li>
            </ul>
        </div>
    </nav>
    
    <div class="main">
        <div class="container">
            <div id="overview" class="section">
                <div class="section-header">
                    <h2>API Overview</h2>
                    <p>Welcome to the AI Crypto Trading Bot API - your gateway to intelligent automated trading</p>
                </div>
                <div class="section-content">
                    <div class="feature-grid">
                        <div class="feature-card">
                            <div class="feature-icon">🤖</div>
                            <h3>AI-Powered Trading</h3>
                            <p>Execute trades with advanced AI analysis, risk assessment, and market sentiment evaluation</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">🔗</div>
                            <h3>N8N Workflow Integration</h3>
                            <p>Seamlessly integrate with n8n workflows for automated trading strategies and notifications</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">📊</div>
                            <h3>Real-Time Portfolio Management</h3>
                            <p>Monitor positions, assess risk, and get comprehensive portfolio analytics in real-time</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">🔒</div>
                            <h3>Enterprise Security</h3>
                            <p>Bearer token authentication, request validation, and comprehensive audit logging</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">⚡</div>
                            <h3>High Performance</h3>
                            <p>Optimized for low-latency trading with built-in rate limiting and error handling</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">📈</div>
                            <h3>Multi-Exchange Support</h3>
                            <p>Connect to Alpaca, Binance, and other major exchanges with unified API interface</p>
                        </div>
                    </div>
                    
                    <h3>Base URL</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Production</span>
                        </div>
                        <pre>https://your-domain.com/api</pre>
                    </div>
                    
                    <div class="auth-section">
                        <h4>🔐 Authentication Required</h4>
                        <p>All API endpoints require Bearer token authentication. Include your API token in the Authorization header:</p>
                        <p><code>Authorization: Bearer your-api-token-here</code></p>
                    </div>
                </div>
            </div>

            <div id="authentication" class="section">
                <div class="section-header">
                    <h2>Authentication & Security</h2>
                    <p>Secure your API requests with Bearer token authentication</p>
                </div>
                <div class="section-content">
                    <h3>Bearer Token Authentication</h3>
                    <p>All API requests must include a valid Bearer token in the Authorization header:</p>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">HTTP Header</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre>Authorization: Bearer ai-trading-bot-secure-2025-integration</pre>
                    </div>
                    
                    <h3>Environment Variables</h3>
                    <p>Configure your authentication tokens using these environment variables:</p>
                    
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>Variable</th>
                                <th>Description</th>
                                <th>Required</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>API_INTEGRATION_BEARER_TOKEN</code></td>
                                <td>Main API authentication token</td>
                                <td><span class="required">Required</span></td>
                            </tr>
                            <tr>
                                <td><code>N8N_API_INTEGRATION_TOKEN</code></td>
                                <td>N8N workflow integration token</td>
                                <td><span class="required">Required</span></td>
                            </tr>
                            <tr>
                                <td><code>ALPACA_API_KEY</code></td>
                                <td>Alpaca trading API key</td>
                                <td><span class="optional">Optional</span></td>
                            </tr>
                            <tr>
                                <td><code>COINGECKO_API_KEY</code></td>
                                <td>CoinGecko market data API key</td>
                                <td><span class="optional">Optional</span></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <h3>Security Features</h3>
                    <ul>
                        <li><strong>Request Validation:</strong> All requests are validated for required parameters and proper format</li>
                        <li><strong>Rate Limiting:</strong> Built-in rate limiting to prevent API abuse</li>
                        <li><strong>Audit Logging:</strong> Comprehensive request logging to Supabase database</li>
                        <li><strong>IP Filtering:</strong> Optional IP-based access control</li>
                        <li><strong>Webhook Signatures:</strong> Cryptographic signature verification for webhook requests</li>
                    </ul>
                    
                    <div class="response-example">
                        <div class="response-title">Authentication Error Response <span class="status-code status-401">401</span></div>
                        <div class="code-block">
                            <pre>{
  "success": false,
  "error": "Unauthorized - Invalid or missing authentication token",
  "requestId": "webhook-1733684400000-abc123def",
  "timestamp": "2025-08-08T12:00:00.000Z"
}</pre>
                        </div>
                    </div>
                </div>
            </div>

            <div id="n8n-integration" class="section">
                <div class="section-header">
                    <h2>N8N Integration API</h2>
                    <p>Primary interface for n8n workflow communication and automated trading actions</p>
                </div>
                <div class="section-content">
                    <div class="endpoint">
                        <div class="endpoint-title">
                            <span class="method post">POST</span>
                            <span class="url">/api/n8n/integration</span>
                            <span class="auth-required">🔒 Auth Required</span>
                        </div>
                        <div class="description">
                            Execute n8n workflow actions including trading operations, portfolio monitoring, and notifications.
                            This endpoint serves as the primary communication channel between your application and n8n workflows.
                        </div>
                        
                        <div class="tabs">
                            <div class="tab-headers">
                                <button class="tab-header active" onclick="switchTab('request', this)">Request</button>
                                <button class="tab-header" onclick="switchTab('response', this)">Response</button>
                                <button class="tab-header" onclick="switchTab('examples', this)">Examples</button>
                            </div>
                            <div class="tab-content">
                                <div class="tab-panel active" data-tab="request">
                                    <h4>Request Parameters</h4>
                                    <table class="parameter-table">
                                        <thead>
                                            <tr>
                                                <th>Parameter</th>
                                                <th>Type</th>
                                                <th>Required</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><code>action</code></td>
                                                <td>string</td>
                                                <td><span class="required">Required</span></td>
                                                <td>The action to perform (see supported actions below)</td>
                                            </tr>
                                            <tr>
                                                <td><code>workflow</code></td>
                                                <td>string</td>
                                                <td><span class="optional">Optional</span></td>
                                                <td>Target workflow: 'trading', 'portfolio', 'notification'</td>
                                            </tr>
                                            <tr>
                                                <td><code>payload</code></td>
                                                <td>object</td>
                                                <td><span class="optional">Optional</span></td>
                                                <td>Action-specific parameters and data</td>
                                            </tr>
                                            <tr>
                                                <td><code>metadata</code></td>
                                                <td>object</td>
                                                <td><span class="optional">Optional</span></td>
                                                <td>Additional context (userId, source, priority)</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    
                                    <h4>Supported Actions</h4>
                                    <div style="margin: 20px 0;">
                                        <h5>Trading Engine Actions:</h5>
                                        <ul>
                                            <li><code>execute_trade</code> - Execute a buy/sell order</li>
                                            <li><code>get_market_data</code> - Retrieve market data for symbols</li>
                                            <li><code>create_strategy</code> - Create a new trading strategy</li>
                                        </ul>
                                        
                                        <h5>Portfolio Monitor Actions:</h5>
                                        <ul>
                                            <li><code>check_portfolio</code> - Get portfolio performance</li>
                                            <li><code>assess_risk</code> - Perform risk assessment</li>
                                            <li><code>get_performance</code> - Get detailed performance metrics</li>
                                        </ul>
                                        
                                        <h5>Notification System Actions:</h5>
                                        <ul>
                                            <li><code>send_notification</code> - Send real-time notifications</li>
                                            <li><code>create_alert</code> - Create price or condition alerts</li>
                                            <li><code>send_report</code> - Generate and send reports</li>
                                        </ul>
                                        
                                        <h5>System Actions:</h5>
                                        <ul>
                                            <li><code>health_check</code> - Check system health status</li>
                                            <li><code>emergency_stop</code> - Emergency stop all workflows</li>
                                            <li><code>stop_execution</code> - Stop specific execution</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="tab-panel" data-tab="response">
                                    <h4>Response Format</h4>
                                    <div class="response-example">
                                        <div class="response-title">Success Response <span class="status-code status-200">200</span></div>
                                        <div class="code-block">
                                            <pre>{
  "success": true,
  "data": {
    "orderId": "order_12345",
    "executedPrice": 50000.00,
    "executedQuantity": 0.001,
    "confidence": 0.87,
    "reasoning": "Strong bullish momentum detected",
    "signals": ["RSI_OVERSOLD", "MACD_BULLISH_CROSS"]
  },
  "timestamp": "2025-08-08T12:00:00.000Z",
  "executionId": "exec_001",
  "workflow": "advanced-ai-trading-engine",
  "statusCode": 200,
  "requestId": "req_abc123"
}</pre>
                                        </div>
                                    </div>
                                    
                                    <div class="response-example">
                                        <div class="response-title">Error Response <span class="status-code status-400">400</span></div>
                                        <div class="code-block">
                                            <pre>{
  "success": false,
  "error": "Unsupported action: invalid_action",
  "supportedActions": [
    "execute_trade", "get_market_data", "create_strategy",
    "check_portfolio", "assess_risk", "get_performance",
    "send_notification", "create_alert", "send_report",
    "health_check", "emergency_stop", "stop_execution"
  ],
  "statusCode": 400,
  "timestamp": "2025-08-08T12:00:00.000Z"
}</pre>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-panel" data-tab="examples">
                                    <h4>Execute Trade Example</h4>
                                    <div class="code-block">
                                        <div class="code-header">
                                            <span class="code-lang">cURL</span>
                                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                                        </div>
                                        <pre>curl -X POST "https://your-domain.com/api/n8n/integration" \
  -H "Authorization: Bearer ai-trading-bot-secure-2025-integration" \
  -H "Content-Type: application/json" \
  -d '{
    "action": "execute_trade",
    "payload": {
      "symbol": "BTCUSD",
      "side": "buy",
      "quantity": 0.001,
      "orderType": "market",
      "stopLoss": 48000,
      "takeProfit": 52000
    },
    "metadata": {
      "userId": "user_123",
      "source": "trading-dashboard",
      "priority": "high"
    }
  }'</pre>
                                    </div>
                                    
                                    <h4>Get Market Data Example</h4>
                                    <div class="code-block">
                                        <div class="code-header">
                                            <span class="code-lang">JavaScript</span>
                                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                                        </div>
                                        <pre>const response = await fetch('https://your-domain.com/api/n8n/integration', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ai-trading-bot-secure-2025-integration',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    action: 'get_market_data',
    payload: {
      symbols: ['BTCUSD', 'ETHUSD', 'ADAUSD'],
      timeframe: '1h'
    },
    metadata: {
      source: 'market-dashboard'
    }
  })
});

const data = await response.json();
console.log('Market data:', data.data);</pre>
                                    </div>
                                    
                                    <h4>Send Notification Example</h4>
                                    <div class="code-block">
                                        <div class="code-header">
                                            <span class="code-lang">Python</span>
                                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                                        </div>
                                        <pre>import requests

url = "https://your-domain.com/api/n8n/integration"
headers = {
    "Authorization": "Bearer ai-trading-bot-secure-2025-integration",
    "Content-Type": "application/json"
}

payload = {
    "action": "send_notification",
    "payload": {
        "type": "trade_execution",
        "message": "Successfully executed BTC buy order at $50,000",
        "channels": ["telegram", "email"],
        "priority": "high"
    },
    "metadata": {
        "source": "trading-engine"
    }
}

response = requests.post(url, json=payload, headers=headers)
data = response.json()

if data["success"]:
    print(f"Notification sent: {data['data']}")
else:
    print(f"Error: {data['error']}")</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="test-button" onclick="testEndpoint('/api/n8n/integration')">
                            🧪 Test This Endpoint
                        </button>
                    </div>
                    
                    <div class="endpoint">
                        <div class="endpoint-title">
                            <span class="method get">GET</span>
                            <span class="url">/api/n8n/integration</span>
                            <span class="auth-required">🔒 Auth Required</span>
                        </div>
                        <div class="description">
                            Get system health, workflow status, or retrieve data without triggering workflow executions.
                        </div>
                        
                        <h4>Query Parameters</h4>
                        <table class="parameter-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>action</code></td>
                                    <td>string</td>
                                    <td><span class="required">Required</span></td>
                                    <td>Action: 'health', 'status', 'market_data', 'portfolio', 'get_executions'</td>
                                </tr>
                                <tr>
                                    <td><code>symbols</code></td>
                                    <td>string</td>
                                    <td><span class="optional">Optional</span></td>
                                    <td>Comma-separated symbol list (for market_data action)</td>
                                </tr>
                                <tr>
                                    <td><code>timeframe</code></td>
                                    <td>string</td>
                                    <td><span class="optional">Optional</span></td>
                                    <td>Time period: '1m', '5m', '1h', '1d'</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="code-block">
                            <div class="code-header">
                                <span class="code-lang">Example: Health Check</span>
                                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                            </div>
                            <pre>GET /api/n8n/integration?action=health

Response:
{
  "success": true,
  "data": {
    "status": "healthy",
    "details": "Connected to n8n. Execution ID: exec_001"
  },
  "timestamp": "2025-08-08T12:00:00.000Z"
}</pre>
                        </div>
                    </div>
                </div>
            </div>

            <div id="n8n-webhook" class="section">
                <div class="section-header">
                    <h2>N8N Webhook Receiver</h2>
                    <p>Advanced webhook endpoint for receiving n8n workflow responses with comprehensive validation</p>
                </div>
                <div class="section-content">
                    <div class="endpoint">
                        <div class="endpoint-title">
                            <span class="method post">POST</span>
                            <span class="url">/api/n8n/webhook</span>
                            <span class="auth-required">🔒 Auth Required</span>
                        </div>
                        <div class="description">
                            Receive webhook responses from n8n workflows with intelligent routing, security validation, 
                            and comprehensive audit logging. Supports automated forwarding to appropriate system endpoints.
                        </div>
                        
                        <div class="tabs">
                            <div class="tab-headers">
                                <button class="tab-header active" onclick="switchTab('webhook-request', this)">Request</button>
                                <button class="tab-header" onclick="switchTab('webhook-response', this)">Response</button>
                                <button class="tab-header" onclick="switchTab('webhook-examples', this)">Examples</button>
                                <button class="tab-header" onclick="switchTab('webhook-security', this)">Security</button>
                            </div>
                            <div class="tab-content">
                                <div class="tab-panel active" data-tab="webhook-request">
                                    <h4>Request Parameters</h4>
                                    <table class="parameter-table">
                                        <thead>
                                            <tr>
                                                <th>Parameter</th>
                                                <th>Type</th>
                                                <th>Required</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><code>action</code></td>
                                                <td>string</td>
                                                <td><span class="required">Required*</span></td>
                                                <td>Workflow action type (alternative to type/workflow)</td>
                                            </tr>
                                            <tr>
                                                <td><code>type</code></td>
                                                <td>string</td>
                                                <td><span class="required">Required*</span></td>
                                                <td>Alternative to action parameter</td>
                                            </tr>
                                            <tr>
                                                <td><code>workflow</code></td>
                                                <td>string</td>
                                                <td><span class="required">Required*</span></td>
                                                <td>Alternative to action parameter</td>
                                            </tr>
                                            <tr>
                                                <td><code>symbol</code></td>
                                                <td>string</td>
                                                <td><span class="optional">Optional</span></td>
                                                <td>Trading symbol for trading actions</td>
                                            </tr>
                                            <tr>
                                                <td><code>capital</code></td>
                                                <td>number</td>
                                                <td><span class="optional">Optional</span></td>
                                                <td>Trading capital amount</td>
                                            </tr>
                                            <tr>
                                                <td><code>riskTolerance</code></td>
                                                <td>string</td>
                                                <td><span class="optional">Optional</span></td>
                                                <td>Risk level: 'LOW', 'MEDIUM', 'HIGH'</td>
                                            </tr>
                                            <tr>
                                                <td colspan="4"><em>*At least one of action, type, or workflow is required</em></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    
                                    <h4>Supported Actions</h4>
                                    <div style="margin: 20px 0;">
                                        <h5>Trading Actions:</h5>
                                        <ul>
                                            <li><code>TRADING</code>, <code>TRADE</code>, <code>AI_TRADING</code> - Route to enhanced trading execution</li>
                                            <li><code>MARKET_ANALYSIS</code> - Trigger market analysis workflow</li>
                                        </ul>
                                        
                                        <h5>Portfolio Actions:</h5>
                                        <ul>
                                            <li><code>PORTFOLIO</code>, <code>PERFORMANCE</code> - Route to portfolio management</li>
                                            <li><code>RISK</code>, <code>MONITORING</code> - Trigger risk assessment</li>
                                        </ul>
                                        
                                        <h5>Notification Actions:</h5>
                                        <ul>
                                            <li><code>NOTIFICATION</code>, <code>ALERT</code>, <code>NOTIFY</code> - Send notifications</li>
                                        </ul>
                                    </div>
                                    
                                    <h4>Headers Required</h4>
                                    <table class="parameter-table">
                                        <thead>
                                            <tr>
                                                <th>Header</th>
                                                <th>Required</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><code>Authorization</code></td>
                                                <td><span class="required">Required</span></td>
                                                <td>Bearer token authentication</td>
                                            </tr>
                                            <tr>
                                                <td><code>Content-Type</code></td>
                                                <td><span class="required">Required</span></td>
                                                <td>Must be 'application/json'</td>
                                            </tr>
                                            <tr>
                                                <td><code>User-Agent</code></td>
                                                <td><span class="optional">Optional</span></td>
                                                <td>Client identification (logged for security)</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="tab-panel" data-tab="webhook-response">
                                    <h4>Response Format</h4>
                                    <div class="response-example">
                                        <div class="response-title">Success Response <span class="status-code status-200">200</span></div>
                                        <div class="code-block">
                                            <pre>{
  "success": true,
  "requestId": "webhook-1733684400000-abc123def",
  "timestamp": "2025-08-08T12:00:00.000Z",
  "execution": {
    "action": "TRADING",
    "targetEndpoint": "/api/trading/enhanced-execution",
    "priority": "HIGH",
    "executionTimeMs": 1250,
    "workflowSuccess": true
  },
  "data": {
    "orderId": "order_12345",
    "executedPrice": 50000.00,
    "confidence": 0.87,
    "reasoning": "Strong bullish momentum detected"
  },
  "metadata": {
    "version": "2.0.0",
    "source": "webhook-api"
  }
}</pre>
                                        </div>
                                    </div>
                                    
                                    <div class="response-example">
                                        <div class="response-title">Validation Error <span class="status-code status-400">400</span></div>
                                        <div class="code-block">
                                            <pre>{
  "success": false,
  "error": "Validation failed",
  "details": [
    "Missing required parameter: action, type, or workflow"
  ],
  "requestId": "webhook-1733684400000-xyz789",
  "timestamp": "2025-08-08T12:00:00.000Z"
}</pre>
                                        </div>
                                    </div>
                                    
                                    <div class="response-example">
                                        <div class="response-title">Authentication Error <span class="status-code status-401">401</span></div>
                                        <div class="code-block">
                                            <pre>{
  "success": false,
  "error": "Unauthorized - Invalid or missing authentication token",
  "requestId": "webhook-1733684400000-xyz789",
  "timestamp": "2025-08-08T12:00:00.000Z"
}</pre>
                                        </div>
                                    </div>
                                    
                                    <h4>Response Headers</h4>
                                    <table class="parameter-table">
                                        <thead>
                                            <tr>
                                                <th>Header</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><code>X-Request-ID</code></td>
                                                <td>Unique request identifier for tracking</td>
                                            </tr>
                                            <tr>
                                                <td><code>X-Execution-Time</code></td>
                                                <td>Total execution time in milliseconds</td>
                                            </tr>
                                            <tr>
                                                <td><code>X-API-Version</code></td>
                                                <td>API version (currently 2.0.0)</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="tab-panel" data-tab="webhook-examples">
                                    <h4>Trading Webhook Example</h4>
                                    <div class="code-block">
                                        <div class="code-header">
                                            <span class="code-lang">cURL</span>
                                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                                        </div>
                                        <pre>curl -X POST "https://your-domain.com/api/n8n/webhook" \
  -H "Authorization: Bearer ai-trading-bot-secure-2025-integration" \
  -H "Content-Type: application/json" \
  -H "User-Agent: n8n-workflow/1.0" \
  -d '{
    "action": "TRADING",
    "symbol": "BTC",
    "capital": 50000,
    "riskTolerance": "MEDIUM",
    "executionId": "exec_n8n_001",
    "workflowName": "AI-Trading-Strategy-v2"
  }'</pre>
                                    </div>
                                    
                                    <h4>Portfolio Monitor Webhook</h4>
                                    <div class="code-block">
                                        <div class="code-header">
                                            <span class="code-lang">JavaScript</span>
                                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                                        </div>
                                        <pre>const webhookResponse = await fetch('https://your-domain.com/api/n8n/webhook', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ai-trading-bot-secure-2025-integration',
    'Content-Type': 'application/json',
    'User-Agent': 'n8n-portfolio-monitor/1.0'
  },
  body: JSON.stringify({
    type: 'PORTFOLIO',
    accountId: 'default',
    includeHistory: true,
    timeframe: '1d',
    requestSource: 'portfolio-monitor-workflow'
  })
});

const result = await webhookResponse.json();

if (result.success) {
  console.log('Portfolio data:', result.data);
  console.log('Execution time:', result.execution.executionTimeMs + 'ms');
} else {
  console.error('Webhook error:', result.error);
}</pre>
                                    </div>
                                    
                                    <h4>Notification Webhook</h4>
                                    <div class="code-block">
                                        <div class="code-header">
                                            <span class="code-lang">Python</span>
                                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                                        </div>
                                        <pre>import requests
import json

url = "https://your-domain.com/api/n8n/webhook"
headers = {
    "Authorization": "Bearer ai-trading-bot-secure-2025-integration",
    "Content-Type": "application/json",
    "User-Agent": "n8n-notification-system/1.0"
}

webhook_data = {
    "workflow": "NOTIFICATION",
    "notificationType": "TRADE_ALERT",
    "message": "BTC price reached $50,000 - Strategy triggered",
    "priority": "HIGH",
    "channels": ["telegram", "email"],
    "executionContext": {
        "triggerPrice": 50000,
        "symbol": "BTC/USD",
        "confidence": 0.89
    }
}

try:
    response = requests.post(url, headers=headers, json=webhook_data, timeout=30)
    result = response.json()
    
    if result["success"]:
        print(f"✅ Webhook processed successfully")
        print(f"Request ID: {result['requestId']}")
        print(f"Execution time: {result['execution']['executionTimeMs']}ms")
        if result.get("data"):
            print(f"Response data: {json.dumps(result['data'], indent=2)}")
    else:
        print(f"❌ Webhook failed: {result['error']}")
        
except requests.exceptions.RequestException as e:
    print(f"🔥 Network error: {e}")
except json.JSONDecodeError as e:
    print(f"🔥 JSON decode error: {e}")
</pre>
                                    </div>
                                </div>
                                <div class="tab-panel" data-tab="webhook-security">
                                    <h4>Security Features</h4>
                                    
                                    <div class="auth-section">
                                        <h4>🔐 Authentication Validation</h4>
                                        <p>Every request must include a valid Bearer token matching the configured API integration token.</p>
                                        <p>Expected format: <code>Authorization: Bearer ai-trading-bot-secure-2025-integration</code></p>
                                    </div>
                                    
                                    <h5>Request Validation</h5>
                                    <ul>
                                        <li><strong>JSON Schema Validation:</strong> Request body must be valid JSON</li>
                                        <li><strong>Required Parameters:</strong> At least one of action, type, or workflow must be provided</li>
                                        <li><strong>Content-Type Check:</strong> Must be application/json</li>
                                        <li><strong>Payload Size Limits:</strong> Reasonable limits on request size</li>
                                    </ul>
                                    
                                    <h5>Security Monitoring</h5>
                                    <ul>
                                        <li><strong>User-Agent Analysis:</strong> Suspicious user agents are flagged</li>
                                        <li><strong>Rate Limiting:</strong> Built-in protection against abuse</li>
                                        <li><strong>IP Tracking:</strong> Client IP addresses logged for audit</li>
                                        <li><strong>Request Fingerprinting:</strong> Unique request IDs for tracking</li>
                                    </ul>
                                    
                                    <h5>Audit Logging</h5>
                                    <p>All webhook requests are logged to Supabase with the following information:</p>
                                    <ul>
                                        <li>Request ID, timestamp, and execution time</li>
                                        <li>Client IP, User-Agent, and origin</li>
                                        <li>Authentication status and payload</li>
                                        <li>Response status and any security warnings</li>
                                        <li>Target endpoint and execution results</li>
                                    </ul>
                                    
                                    <div class="code-block">
                                        <div class="code-header">
                                            <span class="code-lang">Security Warning Example</span>
                                        </div>
                                        <pre>{
  "success": true,
  "requestId": "webhook-1733684400000-abc123",
  "execution": { ... },
  "data": { ... },
  "metadata": {
    "version": "2.0.0",
    "source": "webhook-api",
    "securityWarnings": [
      "Suspicious user agent detected"
    ]
  }
}</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="test-button" onclick="testEndpoint('/api/n8n/webhook')">
                            🧪 Test This Endpoint
                        </button>
                    </div>
                    
                    <div class="endpoint">
                        <div class="endpoint-title">
                            <span class="method get">GET</span>
                            <span class="url">/api/n8n/webhook</span>
                            <span class="auth-required">🔒 Auth Required</span>
                        </div>
                        <div class="description">
                            Health check endpoint for the webhook receiver. Returns operational status and configuration information.
                        </div>
                        
                        <div class="code-block">
                            <div class="code-header">
                                <span class="code-lang">Health Check Response</span>
                                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                            </div>
                            <pre>GET /api/n8n/webhook

Response:
{
  "status": "operational",
  "service": "n8n-webhook-api",
  "version": "2.0.0",
  "timestamp": "2025-08-08T12:00:00.000Z",
  "endpoints": {
    "webhook": "/api/n8n/webhook",
    "methods": ["POST"],
    "authentication": "Bearer token required",
    "supportedActions": ["TRADING", "PORTFOLIO", "NOTIFICATION"]
  },
  "health": {
    "database": "configured",
    "authentication": "configured",
    "tradingCapital": "50000"
  }
}</pre>
                        </div>
                    </div>
                    
                    <div class="endpoint">
                        <div class="endpoint-title">
                            <span class="method">OPTIONS</span>
                            <span class="url">/api/n8n/webhook</span>
                        </div>
                        <div class="description">
                            CORS preflight support for cross-origin requests from web applications.
                        </div>
                        
                        <div class="code-block">
                            <div class="code-header">
                                <span class="code-lang">CORS Headers</span>
                            </div>
                            <pre>Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: POST, OPTIONS
Access-Control-Allow-Headers: Content-Type, Authorization, X-Request-ID, X-Priority
Access-Control-Max-Age: 86400</pre>
                        </div>
                    </div>
                </div>
            </div>

            <div id="trading-execution" class="section">
                <div class="section-header">
                    <h2>Enhanced Trading Execution API</h2>
                    <p>Direct AI-powered trading interface with real-time market analysis and portfolio management</p>
                </div>
                <div class="section-content">
                    <div class="endpoint">
                        <div class="endpoint-title">
                            <span class="method post">POST</span>
                            <span class="url">/api/trading/execute</span>
                            <span class="auth-required">🔒 Auth Required</span>
                        </div>
                        <div class="description">
                            Execute AI-driven trades with advanced market analysis, risk assessment, and automated position management. 
                            This endpoint combines multiple data sources and AI reasoning to make intelligent trading decisions.
                        </div>
                        
                        <div class="tabs">
                            <div class="tab-headers">
                                <button class="tab-header active" onclick="switchTab('trading-request', this)">Request</button>
                                <button class="tab-header" onclick="switchTab('trading-response', this)">Response</button>
                                <button class="tab-header" onclick="switchTab('trading-examples', this)">Examples</button>
                                <button class="tab-header" onclick="switchTab('trading-ai', this)">AI Features</button>
                            </div>
                            <div class="tab-content">
                                <div class="tab-panel active" data-tab="trading-request">
                                    <h4>Request Parameters</h4>
                                    <table class="parameter-table">
                                        <thead>
                                            <tr>
                                                <th>Parameter</th>
                                                <th>Type</th>
                                                <th>Required</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><code>action</code></td>
                                                <td>string</td>
                                                <td><span class="required">Required</span></td>
                                                <td>Must be "execute" to trigger trade execution</td>
                                            </tr>
                                            <tr>
                                                <td><code>symbol</code></td>
                                                <td>string</td>
                                                <td><span class="required">Required</span></td>
                                                <td>Trading symbol (e.g., "BTC", "ETH", "AAPL")</td>
                                            </tr>
                                            <tr>
                                                <td><code>capital</code></td>
                                                <td>number</td>
                                                <td><span class="required">Required</span></td>
                                                <td>Capital amount to allocate for the trade</td>
                                            </tr>
                                            <tr>
                                                <td><code>side</code></td>
                                                <td>string</td>
                                                <td><span class="optional">Optional</span></td>
                                                <td>Trade direction: "buy" or "sell" (AI decides if omitted)</td>
                                            </tr>
                                            <tr>
                                                <td><code>orderType</code></td>
                                                <td>string</td>
                                                <td><span class="optional">Optional</span></td>
                                                <td>Order type: "market", "limit" (default: "market")</td>
                                            </tr>
                                            <tr>
                                                <td><code>riskLevel</code></td>
                                                <td>string</td>
                                                <td><span class="optional">Optional</span></td>
                                                <td>Risk tolerance: "LOW", "MEDIUM", "HIGH"</td>
                                            </tr>
                                            <tr>
                                                <td><code>strategy</code></td>
                                                <td>string</td>
                                                <td><span class="optional">Optional</span></td>
                                                <td>Strategy: "momentum", "meanReversion", "aiAdaptive"</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    
                                    <h4>Supported Trading Symbols</h4>
                                    <div style="margin: 20px 0;">
                                        <h5>Cryptocurrencies:</h5>
                                        <p><code>BTC, ETH, ADA, SOL, MATIC, DOT, LINK, UNI, AAVE, SUSHI, COMP, MKR, SNX, YFI, CRV</code></p>
                                        
                                        <h5>US Stocks:</h5>
                                        <p><code>AAPL, GOOGL, MSFT, AMZN, TSLA, NVDA, META, NFLX, AMD, INTC, CRM, ADBE, PYPL, SQ</code></p>
                                    </div>
                                    
                                    <div class="auth-section">
                                        <h4>🤖 AI-Powered Decision Making</h4>
                                        <p>When you don't specify trade direction, the AI analyzes multiple factors:</p>
                                        <ul>
                                            <li>Technical indicators (RSI, MACD, Moving Averages)</li>
                                            <li>Market sentiment and news analysis</li>
                                            <li>Portfolio balance and risk metrics</li>
                                            <li>Historical performance patterns</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="tab-panel" data-tab="trading-response">
                                    <h4>Success Response</h4>
                                    <div class="response-example">
                                        <div class="response-title">AI Trade Execution Response <span class="status-code status-200">200</span></div>
                                        <div class="code-block">
                                            <pre>{
  "success": true,
  "execution": {
    "orderId": "order_ai_12345",
    "symbol": "BTC",
    "side": "buy",
    "quantity": 0.001,
    "executedPrice": 50000.00,
    "executedQuantity": 0.001,
    "estimatedFees": 0.75,
    "totalCost": 50.75,
    "confidence": 0.89,
    "reasoning": "Strong bullish momentum detected with RSI oversold condition and positive news sentiment",
    "signals": ["RSI_OVERSOLD", "MACD_BULLISH_CROSS", "VOLUME_SPIKE", "NEWS_POSITIVE"],
    "riskScore": 0.25,
    "strategy": "AI Momentum",
    "aiAnalysis": {
      "technicalScore": 0.82,
      "sentimentScore": 0.76,
      "riskAssessment": "LOW",
      "expectedReturn": 0.15,
      "timeHorizon": "7-14 days",
      "stopLoss": 47500.00,
      "takeProfit": 55000.00
    }
  },
  "mode": "paper",
  "timestamp": "2025-08-08T12:00:00.000Z",
  "portfolio": {
    "availableBalance": 49949.25,
    "totalEquity": 50075.00,
    "activePositions": 3,
    "dayPnL": 125.50,
    "dayPnLPercent": 0.25
  }
}</pre>
                                        </div>
                                    </div>
                                    
                                    <div class="response-example">
                                        <div class="response-title">Error Response <span class="status-code status-400">400</span></div>
                                        <div class="code-block">
                                            <pre>{
  "success": false,
  "error": "Missing required parameters: symbol and capital",
  "timestamp": "2025-08-08T12:00:00.000Z"
}</pre>
                                        </div>
                                    </div>
                                    
                                    <h4>Response Fields Explained</h4>
                                    <table class="parameter-table">
                                        <thead>
                                            <tr>
                                                <th>Field</th>
                                                <th>Type</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><code>confidence</code></td>
                                                <td>number</td>
                                                <td>AI confidence score (0.0 to 1.0)</td>
                                            </tr>
                                            <tr>
                                                <td><code>reasoning</code></td>
                                                <td>string</td>
                                                <td>Human-readable explanation of trade decision</td>
                                            </tr>
                                            <tr>
                                                <td><code>signals</code></td>
                                                <td>array</td>
                                                <td>Technical and sentiment signals detected</td>
                                            </tr>
                                            <tr>
                                                <td><code>riskScore</code></td>
                                                <td>number</td>
                                                <td>Risk assessment (0.0 = lowest risk, 1.0 = highest)</td>
                                            </tr>
                                            <tr>
                                                <td><code>expectedReturn</code></td>
                                                <td>number</td>
                                                <td>Expected return percentage</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="tab-panel" data-tab="trading-examples">
                                    <h4>Execute BTC Trade with AI Decision</h4>
                                    <div class="code-block">
                                        <div class="code-header">
                                            <span class="code-lang">cURL</span>
                                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                                        </div>
                                        <pre>curl -X POST "https://your-domain.com/api/trading/execute" \
  -H "Authorization: Bearer ai-trading-bot-secure-2025-integration" \
  -H "Content-Type: application/json" \
  -d '{
    "action": "execute",
    "symbol": "BTC",
    "capital": 1000,
    "riskLevel": "MEDIUM",
    "strategy": "aiAdaptive"
  }'</pre>
                                    </div>
                                    
                                    <h4>Manual Buy Order with Specific Parameters</h4>
                                    <div class="code-block">
                                        <div class="code-header">
                                            <span class="code-lang">JavaScript</span>
                                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                                        </div>
                                        <pre>const executeTrade = async () => {
  try {
    const response = await fetch('https://your-domain.com/api/trading/execute', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ai-trading-bot-secure-2025-integration',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        action: 'execute',
        symbol: 'TSLA',
        capital: 5000,
        side: 'buy',
        orderType: 'limit',
        riskLevel: 'LOW',
        strategy: 'momentum'
      })
    });

    const data = await response.json();

    if (data.success) {
      console.log('✅ Trade executed successfully!');
      console.log(`Order ID: ${data.execution.orderId}`);
      console.log(`Confidence: ${data.execution.confidence * 100}%`);
      console.log(`Reasoning: ${data.execution.reasoning}`);
      console.log(`Expected Return: ${data.execution.aiAnalysis.expectedReturn * 100}%`);
      
      // Display portfolio update
      console.log(`Available Balance: $${data.portfolio.availableBalance.toLocaleString()}`);
      console.log(`Day P&L: $${data.portfolio.dayPnL.toLocaleString()}`);
    } else {
      console.error('❌ Trade failed:', data.error);
    }
  } catch (error) {
    console.error('🔥 Network error:', error);
  }
};

executeTrade();</pre>
                                    </div>
                                    
                                    <h4>Advanced Trading with Risk Management</h4>
                                    <div class="code-block">
                                        <div class="code-header">
                                            <span class="code-lang">Python</span>
                                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                                        </div>
                                        <pre>import requests
import json
from datetime import datetime

class TradingClient:
    def __init__(self, base_url, token):
        self.base_url = base_url
        self.headers = {
            "Authorization": f"Bearer {token}",
            "Content-Type": "application/json"
        }
    
    def execute_ai_trade(self, symbol, capital, risk_level="MEDIUM"):
        """Execute an AI-powered trade with automatic decision making"""
        
        payload = {
            "action": "execute",
            "symbol": symbol,
            "capital": capital,
            "riskLevel": risk_level,
            "strategy": "aiAdaptive"
        }
        
        try:
            response = requests.post(
                f"{self.base_url}/api/trading/execute",
                headers=self.headers,
                json=payload,
                timeout=30
            )
            
            result = response.json()
            
            if result["success"]:
                execution = result["execution"]
                portfolio = result["portfolio"]
                
                print(f"🚀 Trade executed: {execution['side'].upper()} {execution['quantity']} {symbol}")
                print(f"💰 Executed Price: ${execution['executedPrice']:,.2f}")
                print(f"🧠 AI Confidence: {execution['confidence'] * 100:.1f}%")
                print(f"📊 Risk Score: {execution['riskScore']:.2f}/1.0")
                print(f"💡 Reasoning: {execution['reasoning']}")
                
                # AI Analysis Details
                ai_analysis = execution.get("aiAnalysis", {})
                print(f"\n🤖 AI Analysis:")
                print(f"   Technical Score: {ai_analysis.get('technicalScore', 0) * 100:.1f}%")
                print(f"   Sentiment Score: {ai_analysis.get('sentimentScore', 0) * 100:.1f}%")
                print(f"   Expected Return: {ai_analysis.get('expectedReturn', 0) * 100:.1f}%")
                print(f"   Time Horizon: {ai_analysis.get('timeHorizon', 'N/A')}")
                
                # Portfolio Update
                print(f"\n📈 Portfolio Update:")
                print(f"   Available Balance: ${portfolio['availableBalance']:,.2f}")
                print(f"   Total Equity: ${portfolio['totalEquity']:,.2f}")
                print(f"   Active Positions: {portfolio['activePositions']}")
                print(f"   Day P&L: ${portfolio['dayPnL']:,.2f} ({portfolio['dayPnLPercent']:.2f}%)")
                
                return result
            else:
                print(f"❌ Trade failed: {result['error']}")
                return None
                
        except requests.exceptions.RequestException as e:
            print(f"🔥 Network error: {e}")
            return None
        except json.JSONDecodeError as e:
            print(f"🔥 JSON decode error: {e}")
            return None

# Usage Example
if __name__ == "__main__":
    client = TradingClient(
        base_url="https://your-domain.com",
        token="ai-trading-bot-secure-2025-integration"
    )
    
    # Execute AI-powered trades
    client.execute_ai_trade("BTC", 2000, "MEDIUM")
    client.execute_ai_trade("ETH", 1500, "LOW")
    client.execute_ai_trade("AAPL", 3000, "HIGH")</pre>
                                    </div>
                                </div>
                                <div class="tab-panel" data-tab="trading-ai">
                                    <h4>AI Analysis Components</h4>
                                    
                                    <div class="feature-grid">
                                        <div class="feature-card">
                                            <div class="feature-icon">📊</div>
                                            <h3>Technical Analysis</h3>
                                            <p>RSI, MACD, Bollinger Bands, Moving Averages, Volume Analysis, Support/Resistance levels</p>
                                        </div>
                                        <div class="feature-card">
                                            <div class="feature-icon">📰</div>
                                            <h3>Sentiment Analysis</h3>
                                            <p>News sentiment, social media buzz, market fear/greed index, analyst ratings</p>
                                        </div>
                                        <div class="feature-card">
                                            <div class="feature-icon">⚖️</div>
                                            <h3>Risk Assessment</h3>
                                            <p>Volatility analysis, correlation matrices, position sizing, portfolio exposure</p>
                                        </div>
                                        <div class="feature-card">
                                            <div class="feature-icon">🎯</div>
                                            <h3>Strategy Selection</h3>
                                            <p>Momentum, mean reversion, arbitrage, or adaptive strategy based on market conditions</p>
                                        </div>
                                    </div>
                                    
                                    <h4>Trading Signals</h4>
                                    <table class="parameter-table">
                                        <thead>
                                            <tr>
                                                <th>Signal</th>
                                                <th>Type</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><code>RSI_OVERSOLD</code></td>
                                                <td>Technical</td>
                                                <td>RSI below 30, potential buy signal</td>
                                            </tr>
                                            <tr>
                                                <td><code>RSI_OVERBOUGHT</code></td>
                                                <td>Technical</td>
                                                <td>RSI above 70, potential sell signal</td>
                                            </tr>
                                            <tr>
                                                <td><code>MACD_BULLISH_CROSS</code></td>
                                                <td>Technical</td>
                                                <td>MACD line crosses above signal line</td>
                                            </tr>
                                            <tr>
                                                <td><code>VOLUME_SPIKE</code></td>
                                                <td>Technical</td>
                                                <td>Volume significantly above average</td>
                                            </tr>
                                            <tr>
                                                <td><code>NEWS_POSITIVE</code></td>
                                                <td>Sentiment</td>
                                                <td>Positive news sentiment detected</td>
                                            </tr>
                                            <tr>
                                                <td><code>BREAKOUT_RESISTANCE</code></td>
                                                <td>Technical</td>
                                                <td>Price breaks above resistance level</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    
                                    <h4>Strategy Types</h4>
                                    <div style="margin: 20px 0;">
                                        <h5>🚀 Momentum Strategy</h5>
                                        <p>Identifies trending assets and rides the momentum. Best for strong directional moves with high volume confirmation.</p>
                                        
                                        <h5>↔️ Mean Reversion Strategy</h5>
                                        <p>Targets oversold/overbought conditions expecting price to return to mean. Suitable for range-bound markets.</p>
                                        
                                        <h5>⚡ Arbitrage Strategy</h5>
                                        <p>Exploits price differences across exchanges or related instruments. Low risk, consistent returns.</p>
                                        
                                        <h5>🤖 AI Adaptive Strategy</h5>
                                        <p>Dynamically selects the best approach based on current market conditions and historical performance.</p>
                                    </div>
                                    
                                    <div class="auth-section">
                                        <h4>🎯 Risk Management Features</h4>
                                        <ul>
                                            <li><strong>Position Sizing:</strong> Automatic position size calculation based on risk tolerance</li>
                                            <li><strong>Stop Loss:</strong> AI-calculated stop loss levels based on volatility</li>
                                            <li><strong>Take Profit:</strong> Dynamic profit targets based on expected returns</li>
                                            <li><strong>Portfolio Limits:</strong> Maximum positions and exposure limits</li>
                                            <li><strong>Correlation Analysis:</strong> Avoid over-concentration in correlated assets</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="test-button" onclick="testEndpoint('/api/trading/execute')">
                            🧪 Test This Endpoint
                        </button>
                    </div>
                    
                    <div class="endpoint">
                        <div class="endpoint-title">
                            <span class="method get">GET</span>
                            <span class="url">/api/trading/execute</span>
                            <span class="auth-required">🔒 Auth Required</span>
                        </div>
                        <div class="description">
                            Retrieve trading information including positions, history, performance stats, and configuration.
                        </div>
                        
                        <h4>Query Parameters</h4>
                        <table class="parameter-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>action</code></td>
                                    <td>string</td>
                                    <td><span class="required">Required</span></td>
                                    <td>Action: 'positions', 'history', 'stats', 'config'</td>
                                </tr>
                                <tr>
                                    <td><code>limit</code></td>
                                    <td>number</td>
                                    <td><span class="optional">Optional</span></td>
                                    <td>Limit results (for history action, default: 50)</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <h4>Example Requests</h4>
                        <div class="code-block">
                            <div class="code-header">
                                <span class="code-lang">Active Positions</span>
                                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                            </div>
                            <pre>GET /api/trading/execute?action=positions

Response:
{
  "success": true,
  "positions": [
    {
      "symbol": "BTC",
      "side": "long",
      "quantity": 0.001,
      "entryPrice": 50000.00,
      "currentPrice": 51500.00,
      "unrealizedPnL": 1.50,
      "unrealizedPnLPercent": 3.00
    }
  ],
  "count": 1
}</pre>
                        </div>
                        
                        <div class="code-block">
                            <div class="code-header">
                                <span class="code-lang">Performance Stats</span>
                                <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                            </div>
                            <pre>GET /api/trading/execute?action=stats

Response:
{
  "success": true,
  "stats": {
    "totalTrades": 47,
    "winningTrades": 32,
    "losingTrades": 15,
    "winRate": 68.09,
    "totalPnL": 2847.50,
    "totalPnLPercent": 5.70,
    "averageWin": 156.25,
    "averageLoss": -89.30,
    "maxDrawdown": -425.00,
    "sharpeRatio": 1.23
  }
}</pre>
                        </div>
                    </div>
                </div>
            </div>

            <div id="integration-guide" class="section">
                <div class="section-header">
                    <h2>Integration Guide</h2>
                    <p>Step-by-step guide to integrate with n8n workflows and set up automated trading</p>
                </div>
                <div class="section-content">
                    <div class="feature-grid">
                        <div class="feature-card">
                            <div class="feature-icon">🔧</div>
                            <h3>Prerequisites</h3>
                            <ul>
                                <li>n8n instance (cloud or self-hosted)</li>
                                <li>API credentials configured</li>
                                <li>Trading account (Alpaca, Binance)</li>
                                <li>Basic knowledge of webhooks</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">⚡</div>
                            <h3>Quick Setup</h3>
                            <ul>
                                <li>Install n8n workflows</li>
                                <li>Configure API endpoints</li>
                                <li>Set up authentication</li>
                                <li>Test with paper trading</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">🧪</div>
                            <h3>Testing</h3>
                            <ul>
                                <li>Validate API responses</li>
                                <li>Test webhook delivery</li>
                                <li>Monitor execution logs</li>
                                <li>Performance benchmarking</li>
                            </ul>
                        </div>
                    </div>

                    <h3>Step 1: Environment Setup</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Environment Variables</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre># Core API Configuration
API_INTEGRATION_BEARER_TOKEN=ai-trading-bot-secure-2025-integration
N8N_API_INTEGRATION_TOKEN=your-n8n-token-here
NEXT_PUBLIC_BASE_URL=https://your-domain.com

# Trading Exchange APIs
ALPACA_API_KEY=PK6V8YP89R7JPD2O5BA4
ALPACA_SECRET_KEY=your-alpaca-secret
ALPACA_BASE_URL=https://paper-api.alpaca.markets

# Market Data APIs
COINGECKO_API_KEY=CG-aQhKqxLWkcvpJdBi5gHKfQtB
ALPHA_VANTAGE_API_KEY=8PQA774S43BSMFME

# Database (Supabase)
SUPABASE_URL=https://sjtulkkhxojiitpjhgrt.supabase.co
SUPABASE_ANON_KEY=your-supabase-key

# Trading Configuration
TRADING_CAPITAL=50000
RISK_TOLERANCE=MEDIUM
PAPER_TRADING_ENABLED=true</pre>
                    </div>

                    <h3>Step 2: N8N Workflow Configuration</h3>
                    
                    <h4>📊 AI Trading Engine Workflow</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">N8N Workflow JSON</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre>{
  "name": "AI Trading Engine",
  "nodes": [
    {
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "parameters": {
        "path": "api-integration",
        "httpMethod": "POST",
        "authentication": "headerAuth"
      }
    },
    {
      "name": "Market Analysis",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "url": "https://your-domain.com/api/trading/execute",
        "method": "POST",
        "headers": {
          "Authorization": "Bearer ai-trading-bot-secure-2025-integration"
        },
        "body": {
          "action": "execute",
          "symbol": "={{$json.symbol}}",
          "capital": "={{$json.capital}}",
          "strategy": "aiAdaptive"
        }
      }
    },
    {
      "name": "Send Notification",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "url": "https://your-domain.com/api/n8n/webhook",
        "method": "POST",
        "body": {
          "type": "NOTIFICATION",
          "message": "Trade executed: {{$json.execution.reasoning}}",
          "channels": ["telegram"]
        }
      }
    }
  ]
}</pre>
                    </div>

                    <h4>📈 Portfolio Monitor Workflow</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Cron Schedule Setup</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre># Every 15 minutes during market hours
0 */15 9-16 * * 1-5

# Portfolio check node configuration
{
  "name": "Portfolio Health Check",
  "type": "n8n-nodes-base.cron",
  "parameters": {
    "rule": {
      "interval": [
        {
          "field": "cronExpression",
          "expression": "0 */15 9-16 * * 1-5"
        }
      ]
    }
  }
}</pre>
                    </div>

                    <h3>Step 3: API Integration Examples</h3>
                    
                    <h4>React/Next.js Integration</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">React Hook</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre>import { useState, useCallback } from 'react';

export const useAITrading = () => {
  const [loading, setLoading] = useState(false);
  const [results, setResults] = useState(null);
  const [error, setError] = useState(null);

  const executeTrade = useCallback(async (symbol, capital, options = {}) => {
    setLoading(true);
    setError(null);
    
    try {
      const response = await fetch('/api/trading/execute', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'execute',
          symbol,
          capital,
          ...options
        })
      });

      const data = await response.json();
      
      if (!data.success) {
        throw new Error(data.error);
      }

      setResults(data);
      return data;
    } catch (err) {
      setError(err.message);
      throw err;
    } finally {
      setLoading(false);
    }
  }, []);

  const getPortfolioStatus = useCallback(async () => {
    try {
      const response = await fetch('/api/trading/execute?action=stats');
      const data = await response.json();
      return data.stats;
    } catch (err) {
      setError(err.message);
      throw err;
    }
  }, []);

  return {
    executeTrade,
    getPortfolioStatus,
    loading,
    results,
    error
  };
};</pre>
                    </div>

                    <h4>Node.js/Express Integration</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Express Middleware</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre>const express = require('express');
const axios = require('axios');
const app = express();

// Middleware for API authentication
const authenticateAPI = (req, res, next) => {
  const token = req.headers.authorization?.split(' ')[1];
  if (token !== 'ai-trading-bot-secure-2025-integration') {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  next();
};

// Trading webhook handler
app.post('/webhook/trading', authenticateAPI, async (req, res) => {
  try {
    const { symbol, signal, confidence } = req.body;
    
    // Forward to AI Trading Bot
    const response = await axios.post('https://your-domain.com/api/n8n/integration', {
      action: 'execute_trade',
      payload: {
        symbol,
        side: signal === 'BUY' ? 'buy' : 'sell',
        quantity: calculatePositionSize(confidence),
        orderType: 'market'
      },
      metadata: {
        source: 'external-signal',
        confidence
      }
    }, {
      headers: {
        'Authorization': 'Bearer ai-trading-bot-secure-2025-integration',
        'Content-Type': 'application/json'
      }
    });

    res.json({
      success: true,
      tradeId: response.data.executionId,
      message: 'Trade signal processed successfully'
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

function calculatePositionSize(confidence) {
  const baseSize = 0.01; // Base position size
  return baseSize * confidence; // Scale by confidence
}

app.listen(3001, () => {
  console.log('Trading webhook server running on port 3001');
});</pre>
                    </div>

                    <h3>Step 4: Testing & Validation</h3>
                    
                    <div class="auth-section">
                        <h4>🧪 Testing Checklist</h4>
                        <ul>
                            <li><strong>API Connectivity:</strong> Verify all endpoints respond correctly</li>
                            <li><strong>Authentication:</strong> Test bearer token validation</li>
                            <li><strong>Webhook Delivery:</strong> Confirm n8n receives webhook responses</li>
                            <li><strong>Error Handling:</strong> Test invalid requests and edge cases</li>
                            <li><strong>Paper Trading:</strong> Execute test trades in paper mode</li>
                            <li><strong>Performance:</strong> Measure API response times</li>
                        </ul>
                    </div>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">API Health Check Script</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre>#!/bin/bash

# API Health Check Script
BASE_URL="https://your-domain.com"
TOKEN="ai-trading-bot-secure-2025-integration"

echo "🔍 AI Trading Bot API Health Check"
echo "=================================="

# Test N8N Integration endpoint
echo "Testing N8N Integration endpoint..."
curl -s -X POST "$BASE_URL/api/n8n/integration" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"action":"health_check"}' | jq .

# Test Webhook endpoint
echo "Testing Webhook endpoint..."
curl -s -X GET "$BASE_URL/api/n8n/webhook" \
  -H "Authorization: Bearer $TOKEN" | jq .

# Test Trading execution
echo "Testing Trading execution endpoint..."
curl -s -X GET "$BASE_URL/api/trading/execute?action=config" \
  -H "Authorization: Bearer $TOKEN" | jq .

echo "✅ Health check completed!"</pre>
                    </div>
                </div>
            </div>

            <div id="troubleshooting" class="section">
                <div class="section-header">
                    <h2>Troubleshooting & FAQ</h2>
                    <p>Common issues, solutions, and frequently asked questions</p>
                </div>
                <div class="section-content">
                    <h3>Common Issues</h3>
                    
                    <div class="endpoint">
                        <h4>🔒 Authentication Errors</h4>
                        <div class="response-example">
                            <div class="response-title">Problem: 401 Unauthorized</div>
                            <div class="code-block">
                                <pre>{"success": false, "error": "Unauthorized - Invalid or missing authentication token"}</pre>
                            </div>
                        </div>
                        <p><strong>Solutions:</strong></p>
                        <ul>
                            <li>Verify your Bearer token is correct: <code>ai-trading-bot-secure-2025-integration</code></li>
                            <li>Check the Authorization header format: <code>Bearer token</code></li>
                            <li>Ensure the token is set in environment variables</li>
                            <li>Verify there are no extra spaces or special characters</li>
                        </ul>
                    </div>

                    <div class="endpoint">
                        <h4>📡 N8N Connection Issues</h4>
                        <div class="response-example">
                            <div class="response-title">Problem: Webhook not receiving data</div>
                            <div class="code-block">
                                <pre>{"success": false, "error": "N8N request timed out after 30000ms"}</pre>
                            </div>
                        </div>
                        <p><strong>Solutions:</strong></p>
                        <ul>
                            <li>Check n8n webhook URL configuration</li>
                            <li>Verify n8n instance is running and accessible</li>
                            <li>Test webhook endpoint manually with curl</li>
                            <li>Check firewall and network connectivity</li>
                            <li>Validate webhook authentication settings</li>
                        </ul>
                    </div>

                    <div class="endpoint">
                        <h4>💹 Trading Execution Failures</h4>
                        <div class="response-example">
                            <div class="response-title">Problem: Trade execution failed</div>
                            <div class="code-block">
                                <pre>{"success": false, "error": "Insufficient buying power for trade"}</pre>
                            </div>
                        </div>
                        <p><strong>Solutions:</strong></p>
                        <ul>
                            <li>Check available balance in trading account</li>
                            <li>Verify trading symbol is supported</li>
                            <li>Ensure market is open (for stock trading)</li>
                            <li>Review position size limits</li>
                            <li>Check if paper trading mode is enabled</li>
                        </ul>
                    </div>

                    <h3>Frequently Asked Questions</h3>

                    <div class="endpoint">
                        <h4>❓ How do I switch from paper to live trading?</h4>
                        <p>Set the environment variable <code>PAPER_TRADING_ENABLED=false</code> and ensure you have valid live trading credentials configured. Always test thoroughly in paper mode first.</p>
                    </div>

                    <div class="endpoint">
                        <h4>❓ What's the maximum number of concurrent trades?</h4>
                        <p>The system supports up to 5 concurrent positions by default. This can be configured in the trading engine settings via the <code>maxPositions</code> parameter.</p>
                    </div>

                    <div class="endpoint">
                        <h4>❓ How accurate is the AI analysis?</h4>
                        <p>AI confidence scores range from 0.0 to 1.0. Trades with confidence > 0.8 typically have higher success rates. The system combines multiple data sources including technical analysis, sentiment, and market conditions.</p>
                    </div>

                    <div class="endpoint">
                        <h4>❓ Can I customize the trading strategies?</h4>
                        <p>Yes, you can specify strategy types ('momentum', 'meanReversion', 'aiAdaptive') in API requests. The AI Adaptive strategy automatically selects the best approach based on market conditions.</p>
                    </div>

                    <div class="endpoint">
                        <h4>❓ How do I monitor API performance?</h4>
                        <p>All requests include execution time in response headers. Use the <code>X-Execution-Time</code> header and <code>X-Request-ID</code> for tracking. Comprehensive audit logs are stored in Supabase.</p>
                    </div>

                    <h3>Error Codes Reference</h3>
                    
                    <table class="parameter-table">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Description</th>
                                <th>Common Causes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="status-code status-200">200</span></td>
                                <td>Success</td>
                                <td>Request completed successfully</td>
                            </tr>
                            <tr>
                                <td><span class="status-code status-400">400</span></td>
                                <td>Bad Request</td>
                                <td>Missing parameters, invalid JSON, unsupported action</td>
                            </tr>
                            <tr>
                                <td><span class="status-code status-401">401</span></td>
                                <td>Unauthorized</td>
                                <td>Invalid/missing Bearer token</td>
                            </tr>
                            <tr>
                                <td><span class="status-code status-500">500</span></td>
                                <td>Internal Error</td>
                                <td>Server error, database connection, external API failure</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Support & Resources</h3>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <div class="feature-icon">📚</div>
                            <h3>Documentation</h3>
                            <p>Comprehensive API documentation with examples and integration guides</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">🛠️</div>
                            <h3>Development Tools</h3>
                            <p>Postman collections, SDK libraries, and testing utilities</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">📈</div>
                            <h3>Monitoring</h3>
                            <p>Real-time API metrics, error tracking, and performance analytics</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function copyCode(button) {
            const codeBlock = button.closest('.code-block');
            const code = codeBlock.querySelector('pre').textContent;
            
            navigator.clipboard.writeText(code).then(() => {
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                button.textContent = 'Failed';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            });
        }
        
        // Tab functionality
        function switchTab(tabName, element) {
            const tabContainer = element.closest('.tabs');
            
            // Hide all panels
            tabContainer.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // Remove active class from all headers
            tabContainer.querySelectorAll('.tab-header').forEach(header => {
                header.classList.remove('active');
            });
            
            // Show selected panel and activate header
            tabContainer.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            element.classList.add('active');
        }
        
        // Endpoint testing functionality
        function testEndpoint(endpoint) {
            const testModal = createTestModal(endpoint);
            document.body.appendChild(testModal);
        }
        
        function createTestModal(endpoint) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 12px;
                width: 90%;
                max-width: 600px;
                max-height: 80%;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            `;
            
            modalContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0; color: #1e293b;">Test API Endpoint</h3>
                    <button onclick="this.closest('.modal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">&times;</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Endpoint:</label>
                    <div style="background: #f8fafc; padding: 10px; border-radius: 6px; font-family: monospace; color: #1e293b;">${endpoint}</div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Bearer Token:</label>
                    <input type="text" id="testToken" value="ai-trading-bot-secure-2025-integration" 
                           style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-family: monospace;">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Request Body (JSON):</label>
                    <textarea id="testBody" rows="8" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-family: monospace;">${getDefaultTestBody(endpoint)}</textarea>
                </div>
                
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button onclick="executeTest('${endpoint}')" 
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        🧪 Execute Test
                    </button>
                    <button onclick="this.closest('.modal').remove()" 
                            style="background: #f1f5f9; color: #64748b; border: 1px solid #e2e8f0; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        Cancel
                    </button>
                </div>
                
                <div id="testResults" style="display: none;">
                    <h4 style="color: #374151; margin-bottom: 10px;">Response:</h4>
                    <div id="testResponse" style="background: #1e293b; color: #e2e8f0; padding: 15px; border-radius: 8px; font-family: monospace; white-space: pre-wrap; overflow-x: auto;"></div>
                </div>
            `;
            
            modal.appendChild(modalContent);
            modal.className = 'modal';
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            return modal;
        }
        
        function getDefaultTestBody(endpoint) {
            switch (endpoint) {
                case '/api/n8n/integration':
                    return JSON.stringify({
                        action: "health_check"
                    }, null, 2);
                case '/api/n8n/webhook':
                    return JSON.stringify({
                        action: "TRADING",
                        symbol: "BTC",
                        capital: 1000,
                        riskTolerance: "MEDIUM"
                    }, null, 2);
                case '/api/trading/execute':
                    return JSON.stringify({
                        action: "execute",
                        symbol: "BTC",
                        capital: 1000,
                        strategy: "aiAdaptive"
                    }, null, 2);
                default:
                    return JSON.stringify({
                        action: "test"
                    }, null, 2);
            }
        }
        
        async function executeTest(endpoint) {
            const token = document.getElementById('testToken').value;
            const body = document.getElementById('testBody').value;
            const resultsDiv = document.getElementById('testResults');
            const responseDiv = document.getElementById('testResponse');
            
            // Show loading state
            resultsDiv.style.display = 'block';
            responseDiv.textContent = 'Testing... Please wait.';
            responseDiv.style.color = '#fbbf24';
            
            try {
                let requestBody = null;
                if (body.trim()) {
                    try {
                        requestBody = JSON.parse(body);
                    } catch (e) {
                        throw new Error('Invalid JSON in request body');
                    }
                }
                
                const response = await fetch(endpoint, {
                    method: endpoint.includes('/webhook') && !endpoint.includes('?') ? 'POST' : 
                            requestBody ? 'POST' : 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: requestBody ? JSON.stringify(requestBody) : null
                });
                
                const responseData = await response.json();
                
                // Format response
                const formattedResponse = JSON.stringify(responseData, null, 2);
                
                // Set response color based on success
                if (response.ok && responseData.success !== false) {
                    responseDiv.style.color = '#10b981'; // Green for success
                    responseDiv.textContent = `✅ Success (${response.status})\n\n${formattedResponse}`;
                } else {
                    responseDiv.style.color = '#ef4444'; // Red for error
                    responseDiv.textContent = `❌ Error (${response.status})\n\n${formattedResponse}`;
                }
                
            } catch (error) {
                responseDiv.style.color = '#ef4444';
                responseDiv.textContent = `🔥 Network Error:\n\n${error.message}`;
            }
        }
        
        // Smooth scrolling for navigation links
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.nav a[href^="#"]');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href');
                    const targetSection = document.querySelector(targetId);
                    
                    if (targetSection) {
                        const navHeight = document.querySelector('.nav').offsetHeight;
                        const targetPosition = targetSection.offsetTop - navHeight - 20;
                        
                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                        
                        // Update active nav item
                        navLinks.forEach(l => l.classList.remove('active'));
                        this.classList.add('active');
                    }
                });
            });
            
            // Set initial active nav item based on URL hash
            if (window.location.hash) {
                const activeLink = document.querySelector(`.nav a[href="${window.location.hash}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
            } else {
                // Set first link as active by default
                const firstLink = document.querySelector('.nav a');
                if (firstLink) {
                    firstLink.classList.add('active');
                }
            }
        });
    </script>
</body>
</html>